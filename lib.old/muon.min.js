/*
muon.js
https://raw.github.com/minodisk/muon/master/MIT-LICENSE
--
ColorMatrix Class v2.1
released under MIT License (X11)
http://www.opensource.org/licenses/mit-license.php
Author: Mario Klingemann
http:#www.quasimondo.com
*/
(function(){var ArrayUtil,BilateralFilter,Blend,BlurFilter,CSSUtil,CanvasUtil,ColorMatrix,ColorMatrixFilter,DOM,DateUtil,DeficiencyType,DoubleFilter,Easing,Event,EventDispatcher,EventPhase,EventUtil,Filter,GaussianFilter,HTTP,History,JSON,KernelFilter,LaplacianFilter,MathUtil,Matrix,MedianFilter,ObjectUtil,Point,PrewittFilter,QueryString,Rectangle,SobelFilter,StringUtil,Ticker,Transition,Tween,URL,UnsharpMaskFilter,exports,requestAnimationFrame,window,_IDENTITY,_LUMA_B,_LUMA_B2,_LUMA_G,_LUMA_G2,_LUMA_R,_LUMA_R2,_ONETHIRD,_RAD,_cos,_max,_min,_mix,_peg,_sin,_tan,__slice=[].slice,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__bind=function(e,t){return function(){return e.apply(t,arguments)}};window=this,typeof window.muon=="undefined"&&(window.muon={}),typeof window.muon.dom=="undefined"&&(window.muon.dom={}),typeof window.muon.css3=="undefined"&&(window.muon.css3={}),typeof window.muon.events=="undefined"&&(window.muon.events={}),typeof window.muon.filters=="undefined"&&(window.muon.filters={}),typeof window.muon.geom=="undefined"&&(window.muon.geom={}),typeof window.muon.history=="undefined"&&(window.muon.history={}),typeof window.muon.net=="undefined"&&(window.muon.net={}),typeof window.muon.serializer=="undefined"&&(window.muon.serializer={}),typeof window.muon.timers=="undefined"&&(window.muon.timers={}),typeof window.muon.utils=="undefined"&&(window.muon.utils={}),exports=window.muon,exports.css3.Easing=Easing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",easeInQuad:"cubic-bezier(0.550, 0.085, 0.680, 0.530)",easeOutQuad:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",easeInOutQuad:"cubic-bezier(0.455, 0.030, 0.515, 0.955)",easeInQuart:"cubic-bezier(0.895, 0.030, 0.685, 0.220)",easeOutQuart:"cubic-bezier(0.165, 0.840, 0.440, 1.000)",easeInOutQuart:"cubic-bezier(0.770, 0.000, 0.175, 1.000)",easeInQuint:"cubic-bezier(0.755, 0.050, 0.855, 0.060)",easeOutQuint:"cubic-bezier(0.230, 1.000, 0.320, 1.000)",easeInOutQuint:"cubic-bezier(0.860, 0.000, 0.070, 1.000)",easeInCubic:"cubic-bezier(0.550, 0.055, 0.675, 0.190)",easeOutCubic:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1.000)",easeInSine:"cubic-bezier(0.470, 0.000, 0.745, 0.715)",easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",easeInExpo:"cubic-bezier(0.950, 0.050, 0.795, 0.035)",easeOutExpo:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",easeInOutExpo:"cubic-bezier(1.000, 0.000, 0.000, 1.000)",easeInCirc:"cubic-bezier(0.600, 0.040, 0.980, 0.335)",easeOutCirc:"cubic-bezier(0.075, 0.820, 0.165, 1.000)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.150, 0.860)",easeInBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",easeOutBack:"cubic-bezier(0.175,  0.885, 0.320, 1.275)",easeInOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},exports.css3.Transition=Transition=function(){function e(){this._storage={}}return e.prototype.add=function(e,t,n){return/^webkit|moz|ms/i.test(e)&&(e=e.replace(/([A-Za-z]+?[a-z]*)/g,function(e){return"-"+e.toLowerCase()})),this._storage[e]={time:t,easing:n}},e.prototype.remove=function(e){return delete this._storage[e]},e.prototype.toString=function(){var e,t,n,r;t=[],r=this._storage;for(e in r)n=r[e],t.push(""+e+" "+n.time/1e3+"s "+n.easing);return t.join(", ")},e}(),exports.css3.Tween=Tween={_transitions:{},_computedStyles:{},to:function(e,t,n,r,i){var s=this;return r==null&&(r=Easing.ease),setTimeout(function(){var o,u,a,f,l,c,h,p;l={},u=0,o=window.getComputedStyle(e),(c=s._transitions[e])||(c=s._transitions[e]=new Transition);for(f in t)h=t[f],o[f]!==String(h)&&(l[f]=h,c.add(f,n,r),u++);u===0&&setTimeout(function(){return typeof i=="function"?i():void 0},0);if(u!==0){a=function(t){return e=t.target,c=s._transitions[e],c.remove(t.propertyName),e.removeEventListener("webkitTransitionEnd",a),e.style.webkitTransition=c.toString(),typeof i=="function"?i():void 0},e.addEventListener("webkitTransitionEnd",a),e.style.webkitTransition=c.toString(),p=[];for(f in l)h=l[f],p.push(e.style[f]=h);return p}},0)}},exports.dom.DOM=DOM={create:function(e,t,n){var r,i,s;r=document.createElement(e);for(i in t)s=t[i],i==="value"&&(s=StringUtil.escape(s)),r.setAttribute(i,s);return n!=null&&this.setText(r,n),r},getComputedStyle:function(e){return e.currentStyle||document.defaultView.getComputedStyle(e,"")},setText:function(e,t){return typeof e=="string"&&(e=document.createElement(e)),e!=null&&(e.innerHTML=StringUtil.escape(t)),e},getFormData:function(e){var t,n,r,i,s,o;t={},o=e.elements;for(i=0,s=o.length;i<s;i++)n=o[i],n.name&&n.name!==""&&(ArrayUtil.isArray(t[n.name])?t[n.name].push(n.value):t[n.name]!=null?(r=t[n.name],t[n.name]=[n.value]):t[n.name]=n.value);return t},clearForm:function(e){var t,n,r,i,s,o,u,a;n=!0,u=e.elements,a=[];for(s=0,o=u.length;s<o;s++)t=u[s],(r=t.nodeName)==="TEXTAREA"||r==="INPUT"&&((i=t.getAttribute("type"))==="text"||i==="password")?(t.value="",n?(n=!1,a.push(t.focus())):a.push(void 0)):a.push(void 0);return a},prependChild:function(e,t){return t.insertBefore(e,t.firstChild)},insertBefore:function(e,t){return t.parentNode.insertBefore(e,t.nextSibling),e},remove:function(e){var t;return e!=null?(t=e.parentNode)!=null?t.removeChild(e):void 0:void 0},replaceWithInput:function(e){return e.addEventListener("click",function(t){var n,r;return e=t.target,e.style.display="none",r=e.innerHTML,n=document.createElement("input"),n.setAttribute("size",r.length),n.setAttribute("type","text"),n.className="copy",n.value=r,DOM.insertBefore(n,e),function(e,t){return setTimeout(function(){return e.focus(),e.select()},0),e.addEventListener("focusout",function(n){return DOM.remove(e),t.style.display="inline"})}(n,e)})},getRect:function(e){var t,n,r,i,s;n=0,r=0,t=e;while(t)n+=t.offsetLeft||0,r+=t.offsetTop||0,t=t.offsetParent;i=0,s=0,t=e;while(t)i+=t.scrollLeft||0,s+=t.scrollTop||0,t=t.parentNode;return{x:n-i,y:r-s,width:e.offsetWidth,height:e.offsetHeight}},listen:function(){return typeof window.addEventListener=="function"?function(e,t,n){return e.addEventListener(t,n,!1)}:function(e,t,n){return e.attachEvent("on"+t,function(e){return e.stopPropagation=function(){return this.cancelBubble=!0},e.preventDefault=function(){return this.returnValue=!1},n(e)})}}()},exports.events.Event=Event=function(){function e(t,n,r){var i;n==null&&(n=!1),r==null&&(r=!1);if(!(this instanceof e))return new e(t,n,r);t instanceof e&&(i=t,t=i.type,n=i.bubbles,r=i.cancelable,this.currentTarget=i.currentTarget,this.target=i.target),this.type=t,this.bubbles=n,this.cancelable=r,this._isPropagationStopped=!1,this._isPropagationStoppedImmediately=!1,this._isDefaultPrevented=!1}return e.COMPLETE="complete",e.prototype.formatToString=function(){var e,t;return t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],""},e.prototype.stopPropagation=function(){this._isPropagationStopped=!0},e.prototype.stopImmediatePropagation=function(){this._isPropagationStopped=!0,this._isPropagationStoppedImmediately=!0},e.prototype.isDefaultPrevented=function(){return this._isDefaultPrevented},e.prototype.preventDefault=function(){this._isDefaultPrevented=!0},e}(),exports.events.EventDispatcher=EventDispatcher=function(){function e(){this._events={}}return e.prototype.addEventListener=function(e,t,n,r){n==null&&(n=!1),r==null&&(r=0);if(typeof e!="string")throw new ErrorMessage("EventDispatcher#addEventListener: type isn't string");if(typeof t!="function")throw new ErrorMessage("EventDispatcher#addEventListener: listener isn't function");return this._events[e]==null&&(this._events[e]=[]),this._events[e].push({listener:t,useCapture:n,priority:r}),this._events[e].sort(this._sortOnPriorityInDescendingOrder),this},e.prototype.on=e.prototype.addEventListener,e.prototype._sortOnPriorityInDescendingOrder=function(e,t){return t.priority-e.priority},e.prototype.removeEventListener=function(e,t){var n,r;if(r=this._events[e]){n=r.length;while(n--)r[n].listener===t&&r.splice(n,1);r.length===0&&delete this._events[e]}return this},e.prototype.off=e.prototype.removeEventListener,e.prototype.dispatchEvent=function(e){var t,n,r,i;if(e instanceof Event){e.currentTarget=this;if((n=this._events[e.type])!=null)for(r=0,i=n.length;r<i;r++){t=n[r];if(t.useCapture&&e.eventPhase===EventPhase.CAPTURING_PHASE||t.useCapture===!1&&e.eventPhase!==EventPhase.CAPTURING_PHASE){(function(e,t){return setTimeout(function(){return e.listener(t)},0)})(t,e);if(e._isPropagationStoppedImmediately)break}}return!e._isDefaultPrevented}throw new ErrorMessage("EventDispatcher#dispatchEvent: event isn't Event")},e.prototype.emit=e.prototype.dispatchEvent,e}(),exports.events.EventPhase=EventPhase={CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3},_mix=function(e,t,n){return e+((t-e)*n>>8)},_peg=function(e){return e<0?0:e>255?255:e},_min=Math.min,_max=Math.max,exports.filters.Blend=Blend={scan:function(e,t,n){var r,i,s,o,u,a,f;r=e.data,o=t.data;for(i=u=0,a=r.length;u<a;i=u+=4)s=n(r[i],r[i+1],r[i+2],r[i+3],o[i],o[i+1],o[i+2],o[i+3]),[].splice.apply(r,[i,i+3-i+1].concat(f=s.slice(0,4))),f;return e},blend:function(e,t,n,r,i,s,o,u){return[_mix(e,i,u),_mix(t,s,u),_mix(n,o,u),r+u]},add:function(e,t,n,r,i,s,o,u){return[e+(i*u>>8),t+(s*u>>8),n+(o*u>>8),r+u]},subtract:function(e,t,n,r,i,s,o,u){return[e-(i*u>>8),t-(s*u>>8),n-(o*u>>8),r+u]},darkest:function(e,t,n,r,i,s,o,u){return[_mix(e,_min(e,i*u>>8),u),_mix(t,_min(t,s*u>>8),u),_mix(n,_min(n,o*u>>8),u),r+u]},lightest:function(e,t,n,r,i,s,o,u){return[_max(e,i*u>>8),_max(t,s*u>>8),_max(n,o*u>>8),r+u]},difference:function(e,t,n,r,i,s,o,u){return[_mix(e,e>i?e-i:i-e,u),_mix(t,t>s?t-s:s-t,u),_mix(n,n>o?n-o:o-n,u),r+u]},exclusion:function(e,t,n,r,i,s,o,u){return[_mix(e,e+i-(e*i>>7),u),_mix(t,t+s-(t*s>>7),u),_mix(n,n+o-(n*o>>7),u),r+u]},reflex:function(e,t,n,r,i,s,o,u){return[_mix(e,i===255?i:e*e/(255-i),u),_mix(t,s===255?s:t*t/(255-s),u),_mix(n,o===255?o:n*n/(255-o),u),r+u]},multiply:function(e,t,n,r,i,s,o,u){return[_mix(e,e*i>>8,u),_mix(t,t*s>>8,u),_mix(n,n*o>>8,u),r+u]},screen:function(e,t,n,r,i,s,o,u){return[_mix(e,255-((255-e)*(255-i)>>8),u),_mix(t,255-((255-t)*(255-s)>>8),u),_mix(n,255-((255-n)*(255-o)>>8),u),r+u]},overlay:function(e,t,n,r,i,s,o,u){return[_mix(e,e<128?e*i>>7:255-((255-e)*(255-i)>>7),u),_mix(t,t<128?t*s>>7:255-((255-t)*(255-s)>>7),u),_mix(n,n<128?n*o>>7:255-((255-n)*(255-o)>>7),u),r+u]},softLight:function(e,t,n,r,i,s,o,u){return[_mix(e,(e*i>>7)+(e*e>>8)-(e*e*i>>15),u),_mix(t,(t*s>>7)+(t*t>>8)-(t*t*s>>15),u),_mix(n,(n*o>>7)+(n*n>>8)-(n*n*o>>15),u),r+u]},hardLight:function(e,t,n,r,i,s,o,u){return[_mix(e,i<128?e*i>>7:255-((255-e)*(255-i)>>7),u),_mix(t,s<128?t*s>>7:255-((255-t)*(255-s)>>7),u),_mix(n,o<128?n*o>>7:255-((255-n)*(255-o)>>7),u),r+u]},vividLight:function(e,t,n,r,i,s,o,u){return[i===0?0:i===255?255:i<128?255-_peg((255-e<<8)/(i*2)):_peg((e<<8)/((255-i)*2)),s===0?0:s===255?255:s<128?255-_peg((255-t<<8)/(s*2)):_peg((t<<8)/((255-s)*2)),o===0?0:o===255?255:o<128?255-_peg((255-n<<8)/(o*2)):_peg((n<<8)/((255-o)*2)),r+u]},linearLight:function(e,t,n,r,i,s,o,u){return[i<128?_max(i*2+e-255,0):_min(i+e,255),s<128?_max(s*2+t-255,0):_min(s+t,255),o<128?_max(o*2+n-255,0):_min(o+n,255),r+u]},pinLight:function(e,t,n,r,i,s,o,u){return[i<128?_min(i*2,e):_max((i-128)*2,e),s<128?_min(s*2,t):_max((s-128)*2,t),o<128?_min(o*2,n):_max((o-128)*2,n),r+u]},hardMix:function(e,t,n,r,i,s,o,u){var a,f,l;return l=i===0?0:i===255?255:i<128?255-_peg((255-e<<8)/(i*2)):_peg((e<<8)/((255-i)*2)),f=s===0?0:s===255?255:s<128?255-_peg((255-t<<8)/(s*2)):_peg((t<<8)/((255-s)*2)),a=o===0?0:o===255?255:o<128?255-_peg((255-n<<8)/(o*2)):_peg((n<<8)/((255-o)*2)),l=l<128?0:255,f=f<128?0:255,a=a<128?0:255,[e*(255-u)/255+l*u/255,t*(255-u)/255+f*u/255,n*(255-u)/255+a*u/255,r+u]},dodge:function(e,t,n,r,i,s,o,u){return[_mix(e,_peg((e<<8)/(255-i)),u),_mix(t,_peg((t<<8)/(255-s)),u),_mix(n,_peg((n<<8)/(255-o)),u),r+u]},burn:function(e,t,n,r,i,s,o,u){return[_mix(e,i===0?0:255-_peg((255-e<<8)/i),u),_mix(t,s===0?0:255-_peg((255-t<<8)/s),u),_mix(n,o===0?0:255-_peg((255-n<<8)/o),u),r+u]},linearDodge:function(e,t,n,r,i,s,o,u){return[_mix(e,_min(i+e,255),u),_mix(t,_min(t+s,255),u),_mix(n,_min(n+o,255),u),r+u]},linearBurn:function(e,t,n,r,i,s,o,u){return[_mix(e,_max(i+e-255,0),u),_mix(t,_max(t+s-255,0),u),_mix(n,_max(n+o-255,0),u),r+u]}},exports.filters.ColorMatrixFilter=ColorMatrixFilter=function(){function e(e){this.matrix=e}return e.prototype.scan=function(e,t){var n,r,i,s,o,u,a,f,l,c;u=this.matrix,f=e.data,i=t.data;for(o=l=0,c=i.length;l<c;o=l+=4)a=f[o],s=f[o+1],r=f[o+2],n=f[o+3],i[o]=a*u[0]+s*u[1]+r*u[2]+n*u[3]+u[4],i[o+1]=a*u[5]+s*u[6]+r*u[7]+n*u[8]+u[9],i[o+2]=a*u[10]+s*u[11]+r*u[12]+n*u[13]+u[14],i[o+3]=a*u[15]+s*u[16]+r*u[17]+n*u[18]+u[19];return t},e}(),exports.filters.DeficiencyType=DeficiencyType={PROTANOPIA:"protanopia",PROTANOMALY:"protanomaly",DEUTERANOPIA:"deuteranopia",DEUTERNOMALY:"deuteranomaly",TRITANOPIA:"tritanopia",TRITANOMALY:"tritanomaly",ACHROMATOSIA:"achromatopsia",ACHROMATOMALY:"achromatomaly"},exports.filters.Filter=Filter=function(){function e(){}return e.prototype.scan=function(e){var t,n,r;return r=e.getImageData(),n=this._getPixels(r),t=e.createImageData(),this._setPixels(t,n),t},e.prototype._getPixels=function(e){var t,n,r,i,s,o,u,a,f;t=e.data,s=e.width,n=e.height,i=[],r=0;for(u=a=0;a<n;u=a+=1){i[u]=[];for(o=f=0;f<s;o=f+=1)i[u][o]=[t[r],t[r+1],t[r+2],t[r+3]],r+=4}return i},e.prototype._setPixels=function(e,t){var n,r,i,s,o,u,a,f,l;n=e.data,o=e.width,r=e.height,i=0;for(a=f=0;f<r;a=f+=1)for(u=l=0;l<o;u=l+=1)s=this._evaluatePixel(t,u,a,o,r),n[i]=s[0],n[i+1]=s[1],n[i+2]=s[2],n[i+3]=s[3],i+=4},e.prototype._evaluatePixel=function(e,t,n,r,i){return e[n][t]},e}(),_LUMA_R=.212671,_LUMA_G=.71516,_LUMA_B=.072169,_LUMA_R2=.3086,_LUMA_G2=.6094,_LUMA_B2=.082,_ONETHIRD=1/3,_IDENTITY=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],_RAD=Math.PI/180,exports.geom.ColorMatrix=ColorMatrix=function(){function e(t){t instanceof e?this.matrix=t.matrix.concat():Array.isArray(t)?this.matrix=t.concat():this.reset()}return e.prototype.toString=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;r=[],p=this.matrix;for(e=u=0,c=p.length;u<c;e=++u)i=p[e],e%5===0&&(n=[]),n.push(String(i)),(e%5===4||e===this.matrix.length-1)&&r.push(n);for(s=a=0;a<5;s=++a){t=0;for(o=f=0,d=r.length;f<d;o=f+=1)t=Math.max(t,r[o][s].length);for(o=l=0,v=r.length;l<v;o=l+=1)r[o][s]=StringUtil.padLeft(r[o][s],t)}for(o=h=0,m=r.length;h<m;o=h+=1)r[o]=r[o].join(", "),o!==r.length-1&&(r[o]+=",");return r.join("\n")},e.prototype.clone=function(){return new e(this.matrix)},e.prototype.reset=function(){return this.matrix=_IDENTITY.concat()},e.prototype.concat=function(e){var t,n,r,i,s,o,u;t=this.matrix,r=[];for(s=o=0;o<4;s=++o){n=5*s;for(i=u=0;u<5;i=++u)r[n+i]=e[n]*t[i]+e[n+1]*t[i+5]+e[n+2]*t[i+10]+e[n+3]*t[i+15];r[n+4]+=e[n+4]}return this.matrix=r,this},e.prototype.invert=function(){return this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},e.prototype.adjustSaturation=function(e){var t,n,r;return r=-e*_LUMA_R,n=-e*_LUMA_G,t=-e*_LUMA_B,++e,this.concat([r+e,n,t,0,0,r,n+e,t,0,0,r,n,t+e,0,0,0,0,0,1,0])},e.prototype.adjustContrast=function(e,t,n){return t==null&&(t=e),n==null&&(n=e),this.concat([1+e,0,0,0,-128*e,0,1+t,0,0,-128*t,0,0,1+n,0,-128*n,0,0,0,1,0])},e.prototype.adjustBrightness=function(e,t,n){return t==null&&(t=e),n==null&&(n=e),this.concat([1,0,0,0,255*e,0,1,0,0,255*t,0,0,1,0,255*n,0,0,0,1,0])},e.prototype.adjustHue=function(e){var t,n,r,i,s,o,u,a;return r=_LUMA_R,n=_LUMA_G,t=_LUMA_B,e*=_RAD,i=Math.cos(e),a=Math.sin(e),s=1-i,o=s-a,u=s+a,this.concat([r*o+i,n*o,t*o+a,0,0,r*s+a*.143,n*s+i+a*.14,t*s+a*-0.283,0,0,r*u-a,n*u,t*u+i,0,0,0,0,0,1,0])},e.prototype.rotateHue=function(e){return this._initHue(),this.concat(this._preHue.matrix),this.rotateBlue(e),this.concat(this._postHue.matrix)},e.prototype.luminance2Alpha=function(){return this.concat([0,0,0,0,255,0,0,0,0,255,0,0,0,0,255,_LUMA_R,_LUMA_G,_LUMA_B,0,0])},e.prototype.adjustAlphaContrast=function(e){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,e+1,-128*e])},e.prototype.colorize=function(e,t){var n,r,i,s,o,u,a;return t==null&&(t=1),i=_LUMA_R,r=_LUMA_G,n=_LUMA_B,a=(e>>16&255)/255,o=(e>>8&255)/255,s=(e&255)/255,u=1-t,this.concat([u+t*a*i,t*a*r,t*a*n,0,0,t*o*i,u+t*o*r,t*o*n,0,0,t*s*i,t*s*r,u+t*s*n,0,0,0,0,0,1,0])},e.prototype.setChannels=function(e,t,n,r){var i,s,o,u;return e==null&&(e=1),t==null&&(t=2),n==null&&(n=4),r==null&&(r=8),u=((e&1)===1?1:0)+((e&2)===2?1:0)+((e&4)===4?1:0)+((e&8)===8?1:0),u>0&&(u=1/u),o=((t&1)===1?1:0)+((t&2)===2?1:0)+((t&4)===4?1:0)+((t&8)===8?1:0),o>0&&(o=1/o),s=((n&1)===1?1:0)+((n&2)===2?1:0)+((n&4)===4?1:0)+((n&8)===8?1:0),s>0&&(s=1/s),i=((r&1)===1?1:0)+((r&2)===2?1:0)+((r&4)===4?1:0)+((r&8)===8?1:0),i>0&&(i=1/i),this.concat([(e&1)===1?u:0,(e&2)===2?u:0,(e&4)===4?u:0,(e&8)===8?u:0,0,(t&1)===1?o:0,(t&2)===2?o:0,(t&4)===4?o:0,(t&8)===8?o:0,0,(n&1)===1?s:0,(n&2)===2?s:0,(n&4)===4?s:0,(n&8)===8?s:0,0,(r&1)===1?i:0,(r&2)===2?i:0,(r&4)===4?i:0,(r&8)===8?i:0,0])},e.prototype.blend=function(e,t){var n,r,i,s,o;o=e.matrix;for(n=i=0,s=o.length;i<s;n=++i)r=o[n],this.matrix[n]=this.matrix[n]*(1-t)+r*t;return this},e.prototype.average=function(e,t,n){return e==null&&(e=_ONETHIRD),t==null&&(t=_ONETHIRD),n==null&&(n=_ONETHIRD),this.concat([e,t,n,0,0,e,t,n,0,0,e,t,n,0,0,0,0,0,1,0])},e.prototype.threshold=function(e,t){var n,r,i,s;return t==null&&(t=256),i=t*_LUMA_R,r=t*_LUMA_G,n=t*_LUMA_B,s=-t*e,this.concat([i,r,n,0,s,i,r,n,0,s,i,r,n,0,s,0,0,0,1,0])},e.prototype.desaturate=function(){var e,t,n;return n=_LUMA_R,t=_LUMA_G,e=_LUMA_B,this.concat([n,t,e,0,0,n,t,e,0,0,n,t,e,0,0,0,0,0,1,0])},e.prototype.randomize=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return e==null&&(e=1),u=1-e,c=u+e*(Math.random()-Math.random()),i=e*(Math.random()-Math.random()),t=e*(Math.random()-Math.random()),a=e*255*(Math.random()-Math.random()),h=e*(Math.random()-Math.random()),s=u+e*(Math.random()-Math.random()),n=e*(Math.random()-Math.random()),f=e*255*(Math.random()-Math.random()),p=e*(Math.random()-Math.random()),o=e*(Math.random()-Math.random()),r=u+e*(Math.random()-Math.random()),l=e*255*(Math.random()-Math.random()),this.concat([c,i,t,0,a,h,s,n,0,f,p,o,r,0,l,0,0,0,1,0])},e.prototype.setMultiplicators=function(e,t,n,r){return e==null&&(e=1),t==null&&(t=1),n==null&&(n=1),r==null&&(r=1),this.concat([e,0,0,0,0,0,t,0,0,0,0,0,n,0,0,0,0,0,r,0])},e.prototype.clearChannels=function(e,t,n,r){e==null&&(e=!1),t==null&&(t=!1),n==null&&(n=!1),r==null&&(r=!1),e&&(this.matrix[0]=this.matrix[1]=this.matrix[2]=this.matrix[3]=this.matrix[4]=0),t&&(this.matrix[5]=this.matrix[6]=this.matrix[7]=this.matrix[8]=this.matrix[9]=0),n&&(this.matrix[10]=this.matrix[11]=this.matrix[12]=this.matrix[13]=this.matrix[14]=0);if(r)return this.matrix[15]=this.matrix[16]=this.matrix[17]=this.matrix[18]=this.matrix[19]=0},e.prototype.thresholdAlpha=function(e,t){return t==null&&(t=256),this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,t,-t*e])},e.prototype.averageRGB2Alpha=function(){return this.concat([0,0,0,0,255,0,0,0,0,255,0,0,0,0,255,_ONETHIRD,_ONETHIRD,_ONETHIRD,0,0])},e.prototype.invertAlpha=function(){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},e.prototype.rgb2Alpha=function(e,t,n){return this.concat([0,0,0,0,255,0,0,0,0,255,0,0,0,0,255,e,t,n,0,0])},e.prototype.setAlpha=function(e){return this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,e,0])},e.prototype.rotateRed=function(e){return this._rotateColor(e,2,1)},e.prototype.rotateGreen=function(e){return this._rotateColor(e,0,2)},e.prototype.rotateBlue=function(e){return this._rotateColor(e,1,0)},e.prototype._rotateColor=function(e,t,n){var r;return e*=_RAD,r=_IDENTITY.concat(),r[t+t*5]=r[n+n*5]=Math.cos(e),r[n+t*5]=Math.sin(e),r[t+n*5]=-Math.sin(e),this.concat(r)},e.prototype.shearRed=function(e,t){return this._shearColor(0,1,e,2,t)},e.prototype.shearGreen=function(e,t){return this._shearColor(1,0,e,2,t)},e.prototype.shearBlue=function(e,t){return this._shearColor(2,0,e,1,t)},e.prototype._shearColor=function(e,t,n,r,i){var s;return s=_IDENTITY.concat(),s[t+e*5]=n,s[r+e*5]=i,this.concat(s)},e.prototype.applyColorDeficiency=function(e){switch(e){case"Protanopia":this.concat([.567,.433,0,0,0,.558,.442,0,0,0,0,.242,.758,0,0,0,0,0,1,0]);break;case"Protanomaly":this.concat([.817,.183,0,0,0,.333,.667,0,0,0,0,.125,.875,0,0,0,0,0,1,0]);break;case"Deuteranopia":this.concat([.625,.375,0,0,0,.7,.3,0,0,0,0,.3,.7,0,0,0,0,0,1,0]);break;case"Deuteranomaly":this.concat([.8,.2,0,0,0,.258,.742,0,0,0,0,.142,.858,0,0,0,0,0,1,0]);break;case"Tritanopia":this.concat([.95,.05,0,0,0,0,.433,.567,0,0,0,.475,.525,0,0,0,0,0,1,0]);break;case"Tritanomaly":this.concat([.967,.033,0,0,0,0,.733,.267,0,0,0,.183,.817,0,0,0,0,0,1,0]);break;case"Achromatopsia":this.concat([.299,.587,.114,0,0,.299,.587,.114,0,0,.299,.587,.114,0,0,0,0,0,1,0]);break;case"Achromatomaly":this.concat([.618,.32,.062,0,0,.163,.775,.062,0,0,.163,.32,.516,0,0,0,0,0,1,0])}},e.prototype.applyMatrix=function(e){var t,n,r,i,s,o,u,a,f;return t=e>>>24&255,a=e>>>16&255,s=e>>>8&255,r=e&255,u=this.matrix,f=.5+a*u[0]+s*u[1]+r*u[2]+t*u[3]+u[4],o=.5+a*u[5]+s*u[6]+r*u[7]+t*u[8]+u[9],i=.5+a*u[10]+s*u[11]+r*u[12]+t*u[13]+u[14],n=.5+a*u[15]+s*u[16]+r*u[17]+t*u[18]+u[19],n<0&&(n=0),n>255&&(n=255),f<0&&(f=0),f>255&&(f=255),o<0&&(o=0),o>255&&(o=255),i<0&&(i=0),i>255&&(i=255),n<<24|f<<16|o<<8|i},e.prototype.transformVector=function(e){var t,n,r,i,s,o,u,a,f;if(e.length!==4)throw new ErrorMessage("values length isn't 4");return t=this.matrix,f=e[0],a=e[1],u=e[2],o=e[3],s=f*t[0]+a*t[1]+u*t[2]+o*t[3]+t[4],i=f*t[5]+a*t[6]+u*t[7]+o*t[8]+t[9],r=f*t[10]+a*t[11]+u*t[12]+o*t[13]+t[14],n=f*t[15]+a*t[16]+u*t[17]+o*t[18]+t[19],e[0]=s,e[1]=i,e[2]=r,e[3]=n},e.prototype._initHue=function(){var t,n,r,i;n=39.182655;if(!this._hueInitialized)return this._hueInitialized=!0,this._preHue=new e,this._preHue.rotateRed(45),this._preHue.rotateGreen(-n),r=[_LUMA_R2,_LUMA_G2,_LUMA_B2,1],this._preHue.transformVector(r),i=r[0]/r[2],t=r[1]/r[2],this._preHue.shearBlue(i,t),this._postHue=new e,this._postHue.shearBlue(-i,-t),this._postHue.rotateGreen(n),this._postHue.rotateRed(-45)},e}(),_sin=Math.sin,_cos=Math.cos,_tan=Math.tan,exports.geom.Matrix=Matrix=function(){function e(e,t,n,r,i,s){this.xx=e!=null?e:1,this.xy=t!=null?t:0,this.yx=n!=null?n:0,this.yy=r!=null?r:1,this.ox=i!=null?i:0,this.oy=s!=null?s:0}return e.prototype.identity=function(){return this.xx=1,this.xy=0,this.yx=0,this.yy=1,this.ox=0,this.oy=0},e.prototype.clone=function(){return new e(this.xx,this.xy,this.yx,this.yy,this.ox,this.oy)},e.prototype.toString=function(){return""+this.xx+" "+this.yx+" "+this.ox+"\n"+this.xy+" "+this.yy+" "+this.oy+"\n0 0 1"},e.prototype.apply=function(e){var t,n,r,i,s,o;return r=e.xx,i=e.xy,s=e.yx,o=e.yy,t=e.ox,n=e.oy,this._apply(r,i,s,o,t,n)},e.prototype._apply=function(e,t,n,r,i,s){return this.xx=e,this.xy=t,this.yx=n,this.yy=r,this.ox=i,this.oy=s,this},e.prototype.setTo=function(e){return e.setTransform(this.xx,this.xy,this.yx,this.yy,this.ox,this.oy)},e.prototype.concat=function(e){var t,n,r,i,s,o;return r=e.xx,i=e.xy,s=e.yx,o=e.yy,t=e.ox,n=e.oy,this._concat(r,i,s,o,t,n)},e.prototype._concat=function(e,t,n,r,i,s){var o,u,a,f,l,c;return a=this.xx,f=this.xy,l=this.yx,c=this.yy,o=this.ox,u=this.oy,this.xx=e*a+n*f,this.xy=t*a+r*f,this.yx=e*l+n*c,this.yy=t*l+r*c,this.ox=e*o+n*u+i,this.oy=t*o+r*u+s,this},e.prototype.translate=function(e,t){return this._concat(1,0,0,1,e,t)},e.prototype.translatePoint=function(e){var t,n;return t=e.x,n=e.y,this.translate(t,n)},e.prototype.scale=function(e,t){return this._concat(e,0,0,t,0,0)},e.prototype.scalePoint=function(e){var t,n;return t=e.x,n=e.y,this.scale(t,n)},e.prototype.rotate=function(e){var t,n;return t=_cos(e),n=_sin(e),this._concat(t,n,-n,t,0,0)},e.prototype.skew=function(e,t){return this._concat(0,_tan(t),_tan(e),0,0,0)},e.prototype.invert=function(){var e,t,n,r,i,s,o;return r=this.xx,i=this.xy,s=this.yx,o=this.yy,t=this.ox,n=this.oy,e=r*o-i*s,this.xx=o/e,this.xy=-i/e,this.yx=-s/e,this.yy=r/e,this.ox=(s*n-o*t)/e,this.oy=(i*t-r*n)/e,this},e.prototype.transformPoint=function(e){var t,n;return t=e.x,n=e.y,new Point(this.xx*t+this.yx*n+this.ox,this.xy*t+this.yy*n+this.oy)},e.prototype.deltaTransformPoint=function(e){var t,n;return t=e.x,n=e.y,new Point(this.xx*t+this.yx*n,this.xy*t+this.yy*n)},e.prototype.createBox=function(e,t,n,r,i){var s,o;return n==null&&(n=0),r==null&&(r=0),i==null&&(i=0),s=_cos(n),o=_sin(n),this._concat(e*s,t*o,-e*o,t*s,r,i)},e.prototype.createGradientBox=function(e,t,n,r,i){return n==null&&(n=0),r==null&&(r=0),i==null&&(i=0),this.createBox(e/1638.4,t/1638.4,n,r+e/2,i+t/2)},e}(),exports.geom.Point=Point=function(){function e(e,t){this.x=e!=null?e:0,this.y=t!=null?t:0}return e.polar=function(t,n){return new e(t*_cos(n),t*_sin(n))},e.add=function(t,n){return new e(t.x+n.x,t.y+n.y)},e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y)},e.multiple=function(t,n){return new e(t.x*n,t.y*n)},e.divide=function(t,n){return new e(t.x/n,t.y/n)},e.crossProduct=function(e,t){return e.distance*t.distance*_sin(t.angle-e.angle)},e.dotProduct=function(e,t){},e.distance=function(e,t){var n,r;return n=e.x-t.x,r=e.y-t.y,Math.sqrt(n*n+r*r)},e.between=function(t,n,r){return r==null&&(r=.5),new e(t.x+(n.x-t.x)*r,t.y+(n.y-t.y)*r)},e.prototype.distance=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.angle=function(){return Math.atan2(this.y,this.x)},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiple=function(e){return this.x*=e,this.y*=e,this},e.prototype.divide=function(e){return this.x/=e,this.y/=e,this},e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e.prototype.toPolar=function(){return new Polar(this.distance,this.angle)},e.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},e.prototype.normalize=function(e){var t;return e==null&&(e=1),t=e/Math.sqrt(this.x*this.x+this.y*this.y),this.x*=t,this.y*=t,this},e.prototype.transform=function(e){var t;return t=new Matrix(1,0,0,1,this.x,this.y),t.concat(e),this.x=t.ox,this.y=t.oy,this},e}(),exports.geom.Rectangle=Rectangle=function(){function e(e,t,n,r){this.x=e!=null?e:0,this.y=t!=null?t:0,this.width=n!=null?n:0,this.height=r!=null?r:0}return e.prototype.toString=function(){return"[Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},e.prototype.left=function(){return Math.min(this.x,this.x+this.width)},e.prototype.right=function(){return Math.max(this.x,this.x+this.width)},e.prototype.top=function(){return Math.min(this.y,this.y+this.height)},e.prototype.bottom=function(){return Math.max(this.y,this.y+this.height)},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.apply=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},e.prototype.contains=function(e,t){return this.x<e&&e<this.x+this.width&&this.y<t&&t<this.y+this.height},e.prototype.containsPoint=function(e){return this.contains(e.x,e.y)},e.prototype.contain=function(e,t){return e<this.x?(this.width+=this.x-e,this.x=e):e>this.x+this.width&&(this.width=e-this.x),t<this.y?(this.height+=this.y-t,this.y=t):t>this.y+this.height&&(this.height=t-this.y),this},e.prototype.containPoint=function(e){return this.contain(e.x,e.y)},e.prototype.offset=function(e,t){return this.x+=e,this.y+=t,this},e.prototype.offsetPoint=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.inflate=function(e,t){return this.width+=e,this.height+=t,this},e.prototype.inflatePoint=function(e){return this.width+=e.x,this.height+=e.y,this},e.prototype.deflate=function(e,t){return this.width-=e,this.height-=t,this},e.prototype.deflatePoint=function(e){return this.width-=e.x,this.height-=e.y,this},e.prototype.union=function(e){var t,n,r,i,s,o,u,a,f,l;return s=this.x<e.x?this.x:e.x,u=this.x+this.width,a=e.x+e.width,o=u>a?u:a,l=o-s,f=this.y<e.y?this.y:e.y,n=this.y+this.height,r=e.y+e.height,t=n>r?n:r,i=t-f,this.x=s,this.y=f,this.width=l<0?0:l,this.height=i<0?0:i,this},e.prototype.isEmpty=function(){return this.x===0&&this.y===0&&this.width===0&&this.height===0},e.prototype.intersects=function(e){var t,n,r,i,s,o;return r=_max(this.x,e.x),i=_min(this.x+this.width,e.x+e.width),o=i-r,o<=0?!1:(s=_max(this.y,e.y),t=_min(this.y+this.height,e.y+e.height),n=t-s,n<=0?!1:!0)},e.prototype.intersection=function(t){var n,r,i,s,o,u;return i=_max(this.x,t.x),s=_min(this.x+this.width,t.x+t.width),u=s-i,u<=0?new e:(o=_max(this.y,t.y),n=_min(this.y+this.height,t.y+t.height),r=n-o,r<=0?new e:new e(i,o,u,r))},e.prototype.measureFarDistance=function(e,t){var n,r,i,s,o,u,a,f,l;return u=this.x,f=this.x+this.width,l=this.y,n=this.y+this.height,i=e-u,s=e-f,o=t-l,r=t-n,i*=i,s*=s,o*=o,r*=r,a=_max(i+o,s+o,s+r,i+r),_sqrt(a)},e.prototype.adjustOuter=function(){var e,t;return e=Math.floor(this.x),t=Math.floor(this.y),e!==this.x&&this.width++,t!==this.y&&this.height++,this.x=e,this.y=t,this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},e.prototype.transform=function(e){var t,n,r,i,s,o,u,a;return i=new Matrix(1,0,0,1,this.x,this.y),u=new Matrix(1,0,0,1,this.x+this.width,this.y),o=new Matrix(1,0,0,1,this.x+this.width,this.y+this.height),r=new Matrix(1,0,0,1,this.x,this.y+this.height),i.concat(e),u.concat(e),o.concat(e),r.concat(e),n=_min(i.ox,u.ox,o.ox,r.ox),s=_max(i.ox,u.ox,o.ox,r.ox),a=_min(i.oy,u.oy,o.oy,r.oy),t=_max(i.oy,u.oy,o.oy,r.oy),this.x=n,this.y=a,this.width=s-n,this.height=t-a,this},e}(),exports.history.History=History=function(){function e(){}return e}(),exports.net.HTTP=HTTP={createFormData:function(e){var t,n,r,i,s;t=new FormData;for(r=i=0,s=e.length;i<s;r=++i)n=e[r],t.append(n,r);return t},get:function(e,t){return e.method="get",this.request(e,t)},post:function(e,t){return e.method="post",this.request(e,t)},request:function(e,t){var n,r,i,s,o,u,a,f;return s=((a=e.method)!=null?a.toLowerCase():void 0)||"get",o=e.url,i=(f=e.dataType)!=null?f.toLowerCase():void 0,r=e.data,r instanceof FormData||(i==="json"?n="application/json;charset=UTF-8":n="application/x-www-form-urlencoded;charset=UTF-8"),s==="get"&&r!=null&&(o=""+o+"?"+r,r=null),u=new(window.ActiveXObject||XMLHTTPRequest)("Microsoft.XMLHTTP"),e.onProgress!=null&&(u.upload.onprogress=function(t){if(t.lengthComputable)return e.onProgress(t.loaded/t.total)}),e.onComplete!=null&&(u.upload.onload=function(t){return e.onComplete()}),t!=null&&(u.onreadystatechange=function(e){var n;if(u.readyState===4)return(n=u.status)===0||n===200?(r=u.responseText,t(null,r)):t({code:u.status,message:""+u.status+" ("+u.statusText+")"+(u.responseText?": "+u.responseText:"")})}),u.open(s,o,!0),typeof u.overrideMimeType=="function"&&u.overrideMimeType("text/plain"),u.setRequestHeader("X-Requested-With","XMLHTTPRequest"),n&&u.setRequestHeader("content-type",n),u.send(r)}},exports.net.URL=URL={REG_EXP:/^((\w+:)(\/*)?(?:([^@]*)@)?(([^\/]+?)(?::(\d*))?))((\/[^\?#]*)?(\?([^#]*)?)?)?(#.*)?$/,parse:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;t==null&&(t=!1),b=e.match(URL.REG_EXP),o=b[0],l=b[1],d=b[2],g=b[3],n=b[4],i=b[5],s=b[6],p=b[7],c=b[8],h=b[9],m=b[10],v=b[11],r=b[12],a={href:o,origin:l,protocol:d,host:i,hostname:s},t&&(v=QueryString.parse(v)),f={auth:n,port:p,path:c,pathname:h,search:m,query:v,hash:r},g!=null&&(a.slashes=!0,c==null&&(a.path=a.pathname="/",a.href+="/"));for(u in f)y=f[u],y&&(a[u]=y);return a},format:function(e){var t,n,r,i,s,o,u,a,f,l;return u=e.protocol,t=e.auth,r=e.host,i=e.hostname,o=e.port,s=e.pathname,l=e.search,f=e.query,n=e.hash,a=__indexOf.call(URL.CSS,u)>=0?"://":":",r==null&&(r="",i!=null&&(r+=i),o!=null&&(r+=":"+o)),s.charAt(0)!=="/"&&(s="/"+s),l!=null?l.charAt(0)!=="?"&&(l="?"+l):f!=null&&(l="?"+QueryString.stringify(f)),n!=null&&n.charAt(0)!=="#"&&(n="#"+n),""+u+a+r+s+l+n},resolve:function(e,t){}},exports.serializer.JSON=JSON=function(){return window.JSON!=null?window.JSON:(JSON={},function(){var cx,escapable,f,gap,indent,meta,quote,rep,str;f=function(e){return e<10?"0"+e:e},typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap=null,indent=null,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep=null,quote=function(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t;return t=meta[e],typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},str=function(e,t){var n,r,i,s,o,u,a;s=gap,a=t[e],a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,o=[];if(Object.prototype.toString.apply(a)==="[object Array]"){i=a.length,n=0;while(n<i)o[n]=str(n,a)||"null",n+=1;return u=o.length===0?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+s+"]":"["+o.join(",")+"]",gap=s,u}if(rep&&typeof rep=="object"){i=rep.length,n=0;while(n<i)typeof rep[n]=="string"&&(r=rep[n],u=str(r,a),u&&o.push(quote(r)+(gap?": ":":")+u)),n+=1}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(u=str(r,a),u&&o.push(quote(r)+(gap?": ":":")+u));return o.length===0?u="{}":gap?u="{\n"+gap+o.join(",\n"+gap)+"\n"+s+"}":u="{"+o.join(",")+"}",gap=s,u}},typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number"){r=0;while(r<n)indent+=" ",r+=1}else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")});if(typeof JSON.parse!="function")return JSON.parse=function(text,reviver){var j,walk;walk=function(e,t){var n,r,i;i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==void 0?i[n]=r:delete i[n]);return reviver.call(e,t,i)},j=void 0,text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(),JSON)}(),exports.serializer.QueryString=QueryString={stringify:function(e){var t,n,r;n=[];for(t in e)r=e[t],n.push(""+t+"="+encodeURIComponent(r));return n.join("&")},parse:function(e){var t,n,r,i,s,o;if(!e)return{};i=e.split("&");if(i.length===0)throw new ErrorMessage("QueryString.parse: query is invalid");t={};for(s=0,o=i.length;s<o;s++)r=i[s],n=r.split("="),t[n[0]]=decodeURIComponent(n[1]);return t}},exports.timers.requestAnimationFrame=requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(){var e;return e=0,function(t){return setTimeout(t,66),e++}}()}(),exports.utils.ArrayUtil=ArrayUtil={isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},indexOf:typeof Array.prototype.indexOf=="function"?function(e,t,n){return Array.prototype.indexOf.apply(Array.prototype.shift.call(arguments),arguments)}:function(e,t,n){var r,i,s;n==null&&(n=0),i=e.length,n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=i);for(r=s=n;s<=i;r=s+=1)if(r in e&&e[r]===t)return r;return-1},lastIndexOf:typeof Array.prototype.lastIndexOf=="function"?function(e,t,n){return Array.prototype.lastIndexOf.apply(Array.prototype.shift.call(arguments),arguments)}:function(e,t,n){var r,i,s;n==null&&(n=Number.MAX_VALUE),i=e.length,n=n<0?Math.ceil(n):Math.floor(n),n<0?n+=i:n=i-1;for(r=s=n;s>=-1;r=s+=-1)if(r in e&&e[r]===t)return r;return-1},random:function(e,t){var n;t==null&&(t=1);if(t===1)return e[e.length*Math.random()>>0];e=Array.prototype.slice.call(e),n=[];while(t--)n.push(e.splice(e.length*Math.random()>>0,1)[0]);return n},shuffle:function(e){var t,n,r;t=e.length;while(t)n=Math.random()*t>>0,r=e[--t],e[t]=e[n],e[n]=r;return e}},exports.utils.CanvasUtil=CanvasUtil={createCanvas:function(e,t){var n;return n=document.createElement("canvas"),n.width=e,n.height=t,n},clearCanvas:function(e){return e.width=e.width},setAlpha:function(e,t){var n,r,i,s,o;n=e.data,o=[];for(r=i=0,s=n.length;i<s;r=i+=4)o.push(n[r+3]=255*t>>0);return o}},exports.utils.CSSUtil=CSSUtil={parseMatrixString:function(e){var t,n;return t=e.match(/matrix\(\s*([^,]+)\s*,\s*([^,]+)\s*,\s*([^,]+)\s*,\s*([^,]+)\s*,\s*([^,]+)\s*,\s*([^,]+)\s*\)/),t==null?null:(n=window.parseInt,new Matrix(n(t[1],10),n(t[2],10),n(t[3],10),n(t[4],10),n(t[5],10),n(t[6],10)))}},exports.utils.DateUtil=DateUtil={_R_PATTERNS:/%[AaBbCcDdeFHhIjkLlMmNnPpRrSsTtUuvVWwXxYyZz%]/g,keywords:{A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p:["AM","PM"],P:["am","pm"]},_getValue:function(e,t,n){return e["get"+(n?"UTC":"")+t]()},_stringify:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;a=DateUtil.keywords,g=DateUtil._getValue,m=DateUtil.stringify,i=DateUtil.getDays,u=DateUtil.getSundayWeeks,o=DateUtil.getMondayWeeks,s=DateUtil.getISO8601Weeks,h=StringUtil.padLeft,p=function(e){return h(e,2,"0")},d=function(e){return h(e,3,"0")},c=function(e){return h(e,2," ")};switch(t){case"%A":return a.A[g(e,"Day",n)];case"%a":return a.a[g(e,"Day",n)];case"%B":return a.B[g(e,"Month",n)];case"%b":case"%h":return a.b[g(e,"Month",n)];case"%C":return g(e,"FullYear",n)/100>>0;case"%c":return m(e,"%a %b %e %H:%M:%S %Y",n);case"%D":return m(e,"%m/%d/%y",n);case"%d":return p(g(e,"Date",n));case"%e":return c(g(e,"Date",n));case"%F":return m(e,"%Y-%m-%d",n);case"%H":return p(g(e,"Hours",n));case"%I":return p(g(e,"Hours",n)%12);case"%j":return d(i(e));case"%k":return c(g(e,"Hours",n));case"%L":case"%N":return d(g(e,"Milliseconds",n));case"%l":return c(g(e,"Hours",n)%12);case"%M":return p(g(e,"Minutes",n));case"%m":return p(g(e,"Month",n)+1);case"%n":return"\n";case"%P":return a.P[g(e,"Hours",n)/12>>0];case"%p":return a.p[g(e,"Hours",n)/12>>0];case"%R":return m(e,"%H:%M",n);case"%r":return m(e,"%I:%M:%S %p",n);case"%S":return p(g(e,"Seconds",n));case"%s":return e.getTime()/1e3>>0;case"%T":return m(e,"%H:%M:%S",n);case"%t":return"	";case"%U":return p(u(e,n));case"%u":r=g(e,"Day",n);if(r===0)return 7;return r;case"%v":return m(e,"%e-%b-%Y",n).toUpperCase();case"%V":return p(s(e,n));case"%W":return p(o(e,n));case"%w":return g(e,"Day",n);case"%X":return m(e,"%H:%M:%S",n);case"%x":return m(e,"%m/%d/%y",n);case"%Y":return g(e,"FullYear",n);case"%y":return g(e,"FullYear",n)%100;case"%Z":if((f=e.toString().match(/\((\w+)\)/))!=null)return f[1];return void 0;case"%z":return l=e.getTimezoneOffset()*-1,l<0?(v="-",l*=-1):v="+",""+v+p(l/60)+p(l%60);case"%%":return"%";default:throw new Error("Unrecognized pattern '"+t+"'")}},stringify:function(e,t,n){return t==null&&(t="%a %b %d %T %Z %Y"),n==null&&(n=!1),t.replace(DateUtil._R_PATTERNS,function(t){return DateUtil._stringify(e,t,n)})},_parse:function(e,t,n){},parse:function(e,t,n){return n==null&&(n=!1),t.replace(DateUtil._R_PATTERNS,function(e){return console.log(arguments)})},getDays:function(e){var t;return t=new Date(e.getFullYear(),0,1),Math.ceil((e.getTime()-t.getTime()+1)/864e5)},getSundayWeeks:function(e,t){var n,r,i,s,o,u;return u=DateUtil._getValue,n=DateUtil.getDays,o=u(e,"FullYear",t),r=u(new Date(o,0,1),"Day",t),s=n(e),i=0-r,i<0&&(i+=7),Math.ceil((s-i)/7)},getMondayWeeks:function(e,t){var n,r,i,s,o,u;return u=DateUtil._getValue,n=DateUtil.getDays,o=u(e,"FullYear",t),r=u(new Date(o,0,1),"Day",t),s=n(e),i=1-r,i<0&&(i+=7),Math.ceil((s-i)/7)},getISO8601Weeks:function(e,t){var n,r,i,s,o,u,a,f,l,c;return c=DateUtil._getValue,r=DateUtil.getDays,i=DateUtil.getISO8601Weeks,l=c(e,"FullYear",t),s=c(e,"Month",t),n=c(e,"Date",t),o=c(new Date(l,0,1),"Day",t),u=c(new Date(l,11,31),"Day",t),s===0&&n<=3&&(o>=5||o===0)?i(new Date(l,0,0),t):s===11&&n>=29&&u>=1&&u<=3?i(new Date(l,11,32),t):(f=r(e),a=1-o,a<=-4&&(a+=7),Math.ceil((f-a)/7))},getLastDateOfMonth:function(e,t){return new Date(e,t,0)},leap:function(e){return e%4===0&&e%100!==0||e%400===0}},exports.utils.EventUtil=EventUtil={getMousePoint:function(e){var t;return e=((t=e.touches)!=null?t[0]:void 0)||e,{x:e.pageX,y:e.pageY}}},exports.utils.MathUtil=MathUtil={DEGREE_PER_RADIAN:180/Math.PI,RADIAN_PER_DEGREE:Math.PI/180,nearestIn:function(e,t){var n,r,i,s;n=[];for(i=0,s=t.length;i<s;i++)r=t[i],n.push(Math.abs(r-e));return t[n.indexOf(Math.min.apply(null,n))]},randomBetween:function(e,t){return e+(t-e)*Math.random()},convergeBetween:function(e,t,n){var r,i;return i=Math.min(t,n),r=Math.max(t,n),e<i?i:e>r?r:e}},exports.utils.ObjectUtil=ObjectUtil={keys:Object.keys||function(e){var t,n,r;if((n=typeof e)!=="object"&&n!=="function")throw new ErrorMessage(""+e+" isn't Object object");r=[];for(t in e){if(!__hasProp.call(e,t))continue;r.push(t)}return r}},exports.utils.StringUtil=StringUtil={dump:function(e){var t;return t=function(e,n,r,i){var s,o,u,a,f,l,c,h;r==null&&(r=""),i==null&&(i=""),o=n,u="";while(o--)u+="  ";i+="\n",n+=1,s="";switch(typeof e){case"function":return s+="function () { [snip] }";case"string":return s+=""+u+r+'"'+e+'"'+i;case"number":return s+=""+u+r+e+i;default:if(ArrayUtil.isArray(e)){s+=""+u+r+"[\n",f=e.length;for(o=c=0,h=e.length;c<h;o=++c)l=e[o],s+=""+t(l,n,o+": ",o===f-1?"":",");return s+=""+u+"]"+i}s+=""+u+r+"{\n",f=ObjectUtil.keys(e).length,o=0;for(a in e)l=e[a],s+=""+t(l,n,a+": ",o===f-1?"":","),o+=1;return s+=""+u+"}"+i}},t(e,0)},parseBoolean:function(e){return e=e.toLowerCase(),e==="true"||e==="1"},pad:function(e,t,n){n==null&&(n=" "),e=""+e;while(e.length<t)e=(t-e.length&1)===0?n+e:e+n;return e},padLeft:function(e,t,n){n==null&&(n=" "),e=""+e;while(e.length<t)e=n+e;return e},padRight:function(e,t,n){n==null&&(n=" "),e=""+e;while(e.length<t)e+=n;return e},escape:function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},createRandom:function(e,t){var n,r;t==null&&(t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),n=t.length,r="";while(r.length<e)r+=t[Math.random()*n>>0];return r},formatWithComma:function(e){var t,n,r;e=""+e,t=e.length,n=0,r="";while(t--)r=(++n%3===0&&t!==0?",":"")+e.charAt(t)+r;return r}},exports.filters.KernelFilter=KernelFilter=function(e){function t(e,t,n){this.radiusX=e,this.radiusY=t,this.kernel=n}return __extends(t,e),t.prototype.scan=function(e,t){var n,r,i,s,o,u,a,f,l;n=this._getPixels(e);for(i=s=0,a=this.radiusY-1;s<a;i=s+=1)n.unshift(n[0].concat()),n.push(n[n.length-1].concat());for(i=o=0,f=n.length;o<f;i=o+=1)for(r=u=0,l=this.radiusX-1;u<l;r=u+=1)n[i].unshift(n[i][0].concat()),n[i].push(n[i][n[i].length-1].concat());return this._setPixels(t,n),t},t.prototype._evaluatePixel=function(e,t,n,r,i){var s;return s=this._runKernel(this.kernel,e,t,n,r,i),s},t.prototype._runKernel=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;v=c=f=o=0,h=this.radiusY*2-1,y=this.radiusX*2-1,p=0;for(g=b=0;b<h;g=b+=1){a=r+g;for(m=w=0;w<y;m=w+=1)u=n+m,d=t[a][u],l=e[p],v+=d[0]*l,c+=d[1]*l,f+=d[2]*l,o+=d[3]*l,p++}return[v,c,f,o]},t}(Filter),exports.timers.Ticker=Ticker=function(e){function t(){this._onTick=__bind(this._onTick,this);if(!t._isInternal)throw new Error("Call Ticker.getInstance()");t._isInternal=!1,t.__super__.constructor.call(this)}return __extends(t,e),t.getInstance=function(){return t._instance!=null?t._instance:(t._isInternal=!0,t._instance=new t)},t.prototype.start=function(){return this.running=!0,requestAnimationFrame(this._onTick)},t.prototype._onTick=function(){var e;if(this.running)return e=new Event("tick"),e.count=requestAnimationFrame(this._onTick),this.dispatchEvent(e)},t.prototype.stop=function(){return this.running=!1},t}(EventDispatcher),exports.filters.BilateralFilter=BilateralFilter=function(e){function t(e,n,r,i){var s,o,u,a,f,l,c,h,p,d,v;r==null&&(r=1),i==null&&(i=1),a=[],f=2*r*r;for(o=l=p=1-n;l<n;o=l+=1)for(s=c=d=1-e;c<e;s=c+=1)a.push(Math.exp(-(s*s+o*o)/f));t.__super__.constructor.call(this,e,n,a),this.colorWeightMap=[],f=2*i*i;for(u=h=0,v=765;h<v;u=h+=1)this.colorWeightMap[u]=Math.exp(-u*u*f)}return __extends(t,e),t.prototype._runKernel=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;v=t[r+this.radiusY-1][n+this.radiusX-1],c=v[0],l=v[1],f=v[2],m=h=a=0,b=0,p=this.radiusY*2-1,w=this.radiusX*2-1,d=0;for(y=S=0;S<p;y=S+=1){u=r+y;for(g=x=0;x<w;g=x+=1)o=n+g,v=t[u][o],E=e[d]*this.colorWeightMap[Math.abs(v[0]-c)+Math.abs(v[1]-l)+Math.abs(v[2]-f)],b+=E,m+=v[0]*E,h+=v[1]*E,a+=v[2]*E,d++}return[m/b,h/b,a/b]},t}(KernelFilter),exports.filters.BlurFilter=BlurFilter=function(e){function t(e,n){var r,i,s,o;o=e*2-1,s=o*o,r=1/s,i=[];while(s--)i.push(r);t.__super__.constructor.call(this,e,n,i)}return __extends(t,e),t}(KernelFilter),exports.filters.DoubleFilter=DoubleFilter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype._evaluatePixel=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p;l=o=s=0,u=this.radiusY*2-1,c=this.radiusX*2-1;for(a=h=0,p=this.kernel.length;0<=p?h<p:h>p;a=0<=p?++h:--h)f=this._runKernel(this.kernel[a],e,t,n,r,i),l+=f[0]*f[0],o+=f[1]*f[1],s+=f[2]*f[2];return l=Math.sqrt(l),o=Math.sqrt(o),s=Math.sqrt(s),[l,o,s,e[n+this.radiusY-1][t+this.radiusX-1][3]]},t}(KernelFilter),exports.filters.GaussianFilter=GaussianFilter=function(e){function t(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;r==null&&(r=1),a=2*r*r,l=0,u=[];for(s=c=d=1-n;c<n;s=c+=1)for(i=h=v=1-e;h<e;i=h+=1)f=1/(a*Math.PI)*Math.exp(-(i*i+s*s)/a),l+=f,u.push(f);for(o=p=0,m=u.length;p<m;o=p+=1)u[o]/=l;t.__super__.constructor.call(this,e,n,u)}return __extends(t,e),t}(KernelFilter),exports.filters.LaplacianFilter=LaplacianFilter=function(e){function t(e){e==null&&(e=!1),t.__super__.constructor.call(this,2,2,e?[1,1,1,1,-8,1,1,1,1]:[0,1,0,1,-4,1,0,1,0])}return __extends(t,e),t}(KernelFilter),exports.filters.MedianFilter=MedianFilter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype._runKernel=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v;l=[],a=this.radiusY*2-1,p=this.radiusX*2-1,f=0;for(h=d=0;d<a;h=d+=1){u=r+h;for(c=v=0;v<p;c=v+=1)o=n+c,l[f]=t[u][o],f++}return l.sort(this._sortAsSum),l[f>>1]},t.prototype._sortAsSum=function(e,t){var n,r,i,s;r=i=0;for(n=s=0;s<3;n=s+=1)r+=e[n],i+=t[n];return r-i},t}(KernelFilter),exports.filters.UnsharpMaskFilter=UnsharpMaskFilter=function(e){function t(e,n,r){var i,s,o,u,a;this.amount=r!=null?r:1,a=e*2-1,u=i=a*a,s=1/u,o=[];while(i--)o.push(-s);o[u>>1]=1+(1-s)*this.amount,t.__super__.constructor.call(this,e,n,o)}return __extends(t,e),t}(KernelFilter),exports.filters.PrewittFilter=PrewittFilter=function(e){function t(){t.__super__.constructor.call(this,2,2,[[-1,0,1,-1,0,1,-1,0,1],[-1,-1,-1,0,0,0,1,1,1]])}return __extends(t,e),t}(DoubleFilter),exports.filters.SobelFilter=SobelFilter=function(e){function t(){t.__super__.constructor.call(this,2,2,[[-1,0,1,-2,0,2,-1,0,1],[-1,-2,-1,0,0,0,1,2,1]])}return __extends(t,e),t}(DoubleFilter)}).call(this)