/**
 * @fileOverview
 * @name muon.js
 * @author Daisuke Mino daisuke.mino@gmail.com
 * @url https://github.com/minodisk/muon
 * @version 0.1.1
 * @license MIT License
 */
(function(){"use strict";var muon={events:{},net:{},serializer:{},timers:{},utils:{}};(function(){function Event(type,bubbles,cancelable){var event;if(bubbles==null){bubbles=false}if(cancelable==null){cancelable=false}if(!(this instanceof Event)){return new Event(type,bubbles,cancelable)}if(type instanceof Event){event=type;type=event.type;bubbles=event.bubbles;cancelable=event.cancelable;this.currentTarget=event.currentTarget;this.target=event.target}this.type=type;this.bubbles=bubbles;this.cancelable=cancelable;this._isPropagationStopped=false;this._isPropagationStoppedImmediately=false;this._isDefaultPrevented=false}Event.prototype.formatToString=function(){};Event.prototype.stopPropagation=function(){this._isPropagationStopped=true};Event.prototype.stopImmediatePropagation=function(){this._isPropagationStopped=true;this._isPropagationStoppedImmediately=true};Event.prototype.isDefaultPrevented=function(){return this._isDefaultPrevented};Event.prototype.preventDefault=function(){this._isDefaultPrevented=true};this.Event=Event}).call(muon.events);(function(Event,EventPhase){function EventEmitter(){this._events={}}EventEmitter.prototype.on=function(type,listener,useCapture,priority){if(typeof type!=="string"){throw new TypeError("EventEmitter#addEventListener: type isn't string")}if(typeof listener!=="function"){throw new TypeError("EventEmitter#addEventListener: listener isn't function")}if(useCapture==null){useCapture=false}if(priority==null){priority=0}if(this._events[type]==null){this._events[type]=[]}this._events[type].push({listener:listener,useCapture:useCapture,priority:priority});this._events[type].sort(this._sortOnPriorityInDescendingOrder);return this};EventEmitter.prototype._sortOnPriorityInDescendingOrder=function(a,b){return b.priority-a.priority};EventEmitter.prototype.off=function(type,listener){var i,storage;if(storage=this._events[type]){i=storage.length;while(i--){if(storage[i].listener===listener){storage.splice(i,1)}}if(storage.length===0){delete this._events[type]}}return this};EventEmitter.prototype.emit=function(event){var obj,objs,i,len;if(!(event instanceof Event)){throw new TypeError("EventEmitter#dispatchEvent: event isn't Event")}event.currentTarget=this;if((objs=this._events[event.type])!=null){for(i=0,len=objs.length;i<len;i++){obj=objs[i];if(obj.useCapture&&event.eventPhase===EventPhase.CAPTURING_PHASE||obj.useCapture===false&&event.eventPhase!==EventPhase.CAPTURING_PHASE){(function(obj,event){return setTimeout(function(){return obj.listener(event)},0)})(obj,event);if(event._isPropagationStoppedImmediately){break}}}}return!event._isDefaultPrevented};this.EventEmitter=EventEmitter}).call(muon.events,muon.events.Event,muon.events.EventPhase);(function(){var EventPhase={CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3};this.EventPhase=EventPhase}).call(muon.events);(function(){var querystring=this.require("muon.serializer.querystring"),array=this.require("muon.utils.array");var url={},R_URL=/^((\w+:)(\/*)?(?:([^@]*)@)?(([^\/]+?)(?::(\d*))?))((\/[^\?#]*)?(\?([^#]*)?)?)?(#.*)?$/;url.parse=function(urlStr,parseQueryString){if(parseQueryString==null){parseQueryString=false}var matched=urlStr.match(R_URL),href=matched[0],origin=matched[1],protocol=matched[2],slashes=matched[3],auth=matched[4],host=matched[5],hostname=matched[6],port=matched[7],path=matched[8],pathname=matched[9],search=matched[10],query=matched[11],hash=matched[12],obj,opt,key;obj={href:href,origin:origin,protocol:protocol,host:host,hostname:hostname};if(parseQueryString){query=querystring.parse(query)}opt={auth:auth,port:port,path:path,pathname:pathname,search:search,query:query,hash:hash};if(slashes!=null){obj.slashes=true;if(path==null){obj.path=obj.pathname="/";obj.href+="/"}}for(key in opt){value=opt[key];if(value){obj[key]=value}}return obj};url.format=function(urlObj){var protocol=urlObj.protocol,protocolPostfix=__indexOf.call(URL.CSS,protocol)>=0?"://":":",auth=urlObj.auth,host=urlObj.host,hostname=urlObj.hostname,port=urlObj.port,pathname=urlObj.pathname,search=urlObj.search,query=urlObj.query,hash=urlObj.hash;if(host==null){host="";if(hostname!=null){host+=hostname}if(port!=null){host+=":"+port}}if(pathname.charAt(0)!=="/"){pathname="/"+pathname}if(search!=null){if(search.charAt(0)!=="?"){search="?"+search}}else if(query!=null){search="?"+querystring.stringify(query)}if(hash!=null&&hash.charAt(0)!=="#"){hash="#"+hash}return protocol+protocolPostfix+host+pathname+search+hash};url.resolve=function(from,to){};this.url=url}).call(muon.net);(function(){var querystring={},encode=encodeURIComponent;querystring.stringify=function(obj){var key,tokens=[];for(key in obj){tokens.push(key+"="+encode(obj[key]))}return tokens.join("&")};querystring.parse=function(str){if(str==null){return{}}var tokens=str.split("&"),obj={},i=0,len=tokens.length,kv;if(len===0){throw new TypeError}for(;i<len;i++){kv=tokens[i].split("=");obj[kv[0]]=encode(kv[1])}return obj};this.querystring=querystring}).call(muon.serializer);(function(){var requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(){var counter=0;return function(callback){setTimeout(callback,66);return counter++}}()}();this.requestAnimationFrame=requestAnimationFrame}).call(muon.timers);(function(){var array={},_random=Math.random,_shift=Array.prototype.shift,_slice=Array.prototype.slice,_toString=Object.prototype.toString;array.isArray=Array.isArray||function(arr){return _toString.call(arr)==="[object Array]"};array.indexOf=typeof Array.prototype.indexOf==="function"?function(arr,searchElement,fromIndex){return Array.prototype.indexOf.apply(_shift.call(arguments),arguments)}:function(array,searchElement,fromIndex){if(array==null){throw new TypeError("array.indexOf called on null or undefined")}var len=array.length;if(len===0){return-1}var i;if(fromIndex==null){i=0}else if(fromIndex<0){i=fromIndex+len}else{i=fromIndex}if(i<0){i=0}else if(i>len-1){return-1}for(;i<len;i++){if(array[i]===searchElement){return i}}return-1};array.lastIndexOf=typeof Array.prototype.lastIndexOf==="function"?function(array,searchElement,fromIndex){return Array.prototype.lastIndexOf.apply(_shift.call(arguments),arguments)}:function(array,searchElement,fromIndex){if(array==null){throw new TypeError}var len=array.length;if(len===0){return-1}var i;if(fromIndex==null){i=len}else if(fromIndex<0){i=len+fromIndex}else{i=fromIndex}if(i<0){return-1}else if(i>len-1){i=len-1}for(;i>=0;i--){if(array[i]===searchElement){return i}}return-1};array.include=function(arr,elem){return array.indexOf(arr,elem)!==-1};array.compact=function(arr){var i=arr.length,newArr=[];while(i--){if(arr[i]!=null){newArr.unshift(arr[i])}}return newArr};array.delete=function(arr,val){var i=arr.length,deleted=null;while(i--){if(arr[i]===val){deleted=arr.splice(i,1);deleted=deleted.length===1?deleted[0]:null}}return deleted};array.deleteAt=function(arr,index){var deleted=arr.splice(index,1);return deleted.length===1?deleted[0]:null};array.random=function(arr,length){if(arr==null){throw new TypeError}if(length==null){length=1}if(arr.length===0||length<=0){return null}if(length===1){return arr[arr.length*_random()>>0]}arr=_slice.call(arr);var hits=[];while(length--&&arr.length){hits.push(arr.splice(arr.length*_random()>>0,1)[0])}return hits};array.shuffle=function(arr){if(arr==null){throw new TypeError}arr=_slice.call(arr);var i=arr.length,j,v;while(i){j=_random()*i>>0;v=arr[--i];arr[i]=arr[j];arr[j]=v}return arr};array.filter=typeof Array.prototype.filter==="function"?function(array,callback,thisObject){return Array.prototype.filter.apply(_shift.call(arguments),arguments)}:function(array,callback,thisObject){var i,val,_i,_len,_results;if(thisObject==null){thisObject=null}if(typeof callback!=="function"){throw new TypeError}_results=[];for(i=_i=0,_len=array.length;_i<_len;i=++_i){val=array[i];if(i in array&&callback.call(thisObject,val,i,array)){_results.push(val)}}return _results};array.forEach=typeof Array.prototype.forEach==="function"?function(array,callback,thisObject){Array.prototype.forEach.apply(_shift.call(arguments),arguments)}:function(array,callback,thisObject){var i,val,_i,_len;if(thisObject==null){thisObject=null}if(typeof callback!=="function"){throw new TypeError}for(i=_i=0,_len=array.length;_i<_len;i=++_i){val=array[i];if(i in array){callback.call(thisObject,val,i,array)}}};array.every=typeof Array.prototype.every==="function"?function(array,callvack,thisObject){return Array.prototype.every.apply(_shift.call(arguments),arguments)}:function(array,callback,thisObject){var i,val,_i,_len;if(thisObject==null){thisObject=null}if(typeof callback!=="function"){throw new TypeError}for(i=_i=0,_len=array.length;_i<_len;i=++_i){val=array[i];if(i in array&&!callback.call(thisObject,val,i,array)){return false}}return true};array.map=typeof Array.prototype.map==="function"?function(array,callback,thisObject){return Array.prototype.map.apply(_shift.call(arguments),arguments)}:function(array,callback,thisObject){var i,val,_i,_len,_results;if(thisObject==null){thisObject=null}if(typeof callback!=="function"){throw new TypeError}_results=[];for(i=_i=0,_len=array.length;_i<_len;i=++_i){val=array[i];if(i in array){_results.push(callback.call(thisObject,val,i,array))}}return _results};array.some=typeof Array.prototype.some==="function"?function(array,callback,thisObject){return Array.prototype.some.apply(_shift.call(arguments),arguments)}:function(array,callback,thisObject){var i,val,_i,_len;if(thisObject==null){thisObject=null}if(typeof callback!=="function"){throw new TypeError}for(i=_i=0,_len=array.length;_i<_len;i=++_i){val=array[i];if(i(fo(array&&callback.call(thisObject,val,i,array)))){return true}}return false};array.reduce=typeof Array.prototype.reduce==="function"?function(array,callback,initialValue){return Array.prototype.reduce.apply(_shift.call(arguments),arguments)}:function(array,callback,initialValue){var i,len,val,_i,_ref;if(initialValue==null){initialValue=null}len=array.length;if(typeof callback!=="function"||len===0&&initialValue===null){throw new TypeError}i=0;if(initialValue===null){do{if(i in array){initialValue=array[i++];break}if(++i>len){throw new TypeError}}while(true)}for(val=_i=i,_ref=len-1;_i>=_ref;val=_i+=-1){if(val in array){initialValue=callback.call(null,initialValue,array[val],val,array)}}return initialValue};array.reduceRight=typeof Array.prototype.reduceRight==="function"?function(array,callback,initialValue){return Array.prototype.reduceRight.apply(_shift.call(arguments),arguments)}:function(array,callback,initialValue){var i,len,val,_i;if(initialValue==null){initialValue=null}len=array.length;if(typeof callback!=="function"||len===0&&initialValue===null){throw new TypeError}i=len-1;if(initialValue===null){do{if(i in array){initialValue=array[i--];break}if(--i<=len){throw new TypeError}}while(true)}for(val=_i=i;_i>=0;val=_i+=-1){if(val in array){initialValue=callback.call(null,initialValue,array[val],val,array)}}return initialValue};array.toArray=function(arrayLikeObject){return _slice.call(arrayLikeObject)};array.unique=function(array){var storage;storage={};for(var i=0,elem;i<array.length;++i){elem=array[i];if(elem in storage){array.splice(i--,1)}storage[elem]=true}return array};array.rotate=function(array,index){if(index==null){index=1}if(index>0){while(index--){array.push(array.shift())}}else if(index<0){index*=-1;while(index--){array.unshift(array.pop())}}return array};array.transpose=function(array){var cols,columns,elem,i,j,results,row,_i,_j,_len,_len1;results=[];columns=-1;for(i=_i=0,_len=array.length;_i<_len;i=++_i){row=array[i];if(!ArrayUtil.isArray(row)){throw new TypeError("Element isn't Array.")}cols=row.length;if(i!==0&&cols!==columns){throw new Error("Element size differ ("+cols+" should be "+columns+")")}columns=cols;if(i===0){while(cols--){results[cols]=[]}}for(j=_j=0,_len1=row.length;_j<_len1;j=++_j){elem=row[j];results[j].push(elem)}}return results};this.array=array}).call(muon.utils);var tmp=this.muon;muon.conflict=function(){return tmp};this.muon=muon}).call(this)